# 设置 prefix 为 Ctrl-b（默认）
set -g prefix C-b
bind C-b send-prefix

# 设置默认终端模式为 256 色，并启用真彩色
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# 启用鼠标支持
set -g mouse on

# 设置窗口和面板索引从 1 开始（更符合键盘布局）
set -g base-index 1
setw -g pane-base-index 1

# 重新加载配置文件的快捷键：Prefix + r
bind r source-file ~/.tmux.conf \; display "Configuration reloaded!"

# 更好的窗口分割快捷键
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# 在面板之间移动的快捷键（类似 vim）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 调整面板大小的快捷键
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# 使用 vim 键位在缓冲区中移动
setw -g mode-keys vi

# 更容易地复制和粘贴（类似 vim）
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
bind P paste-buffer

# 窗口切换快捷键
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# 创建新窗口时保持在当前目录
bind c new-window -c "#{pane_current_path}"

# 状态栏配置
set -g status-interval 1
set -g status-justify left
set -g status-left-length 100
set -g status-right-length 60

# ========== 浅色系状态栏配色 (Tokyo Night Day) ==========
set -g status-style "bg=#e1e2e7,fg=#3760bf"
set -g window-status-current-style "bg=#3760bf,fg=#ffffff bold"
set -g window-status-style "bg=#e1e2e7,fg=#545c7e"
set -g pane-border-style "fg=#e1e2e7"
set -g pane-active-border-style "fg=#3760bf"
set -g message-style "bg=#3760bf,fg=#ffffff"
set -g message-command-style "bg=#e1e2e7,fg=#3760bf"
set -g status-left '#[bg=#3760bf,fg=#ffffff,bold] #S #[bg=#e1e2e7,fg=#3760bf]'
set -g status-right '#[bg=#e1e2e7,fg=#3760bf] %Y-%m-%d #[fg=#3760bf,bold] %H:%M:%S '
setw -g window-status-format '#I:#W'
setw -g window-status-current-format '#[fg=#ffffff,bg=#3760bf,bold]#I:#W'

# 增加滚动历史记录
set -g history-limit 10000

# 降低按键延迟
set -sg escape-time 1

# 窗口重命名自动关闭
setw -g automatic-rename off

# 状态栏位置（bottom/top）
set -g status-position bottom

# 显示窗口列表
setw -g window-status-format '#I:#W'
setw -g window-status-current-format '#[fg=colour15,bold]#I:#W'

# ============ Tmux Plugin Manager ============
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @plugin 'tmux-plugins/tmux-sidebar'  # tmux-sidebar 已禁用（使用 ranger 替代）

# tmux-resurrect 配置
set -g @resurrect-capture-pane-contents 'on'  # 恢复面板内容
set -g @resurrect-strategy-vim 'session'     # 恢复 vim session
set -g @resurrect-strategy-nvim 'session'    # 恢复 neovim session

# tmux-continuum 配置
set -g @continuum-restore 'on'               # tmux 启动时自动恢复
set -g @continuum-save-interval '15'         # 每 15 分钟自动保存

# Ranger 文件管理器 - 交互式目录树
# -c "#{pane_current_path}" 确保打开当前 pane 的目录
bind-key t split-window -h -p 30 -c "#{pane_current_path}" 'ranger'  # Ctrl+b t

# 初始化 TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
